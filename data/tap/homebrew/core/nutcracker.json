{
  "name": "nutcracker",
  "full_name": "nutcracker",
  "tap": "homebrew/core",
  "oldname": null,
  "oldnames": [],
  "aliases": [
    "twemproxy"
  ],
  "versioned_formulae": [],
  "desc": "Proxy for memcached and redis",
  "license": "Apache-2.0",
  "homepage": "https://github.com/twitter/twemproxy",
  "versions": {
    "stable": "0.5.0",
    "head": "HEAD",
    "bottle": true
  },
  "urls": {
    "stable": {
      "url": "https://github.com/twitter/twemproxy/archive/0.5.0.tar.gz",
      "tag": null,
      "revision": null,
      "checksum": "73f305d8525abbaaa6a5f203c1fba438f99319711bfcb2bb8b2f06f0d63d1633"
    },
    "head": {
      "url": "https://github.com/twitter/twemproxy.git",
      "branch": "master"
    }
  },
  "revision": 1,
  "version_scheme": 0,
  "bottle": {
    "stable": {
      "rebuild": 0,
      "root_url": "https://ghcr.io/v2/homebrew/core",
      "files": {
        "arm64_ventura": {
          "cellar": ":any",
          "url": "https://ghcr.io/v2/homebrew/core/nutcracker/blobs/sha256:72e440a578846be30b99237a05ac9251ad0859aa19fb4603e73671c61add0e66",
          "sha256": "72e440a578846be30b99237a05ac9251ad0859aa19fb4603e73671c61add0e66"
        },
        "arm64_monterey": {
          "cellar": ":any",
          "url": "https://ghcr.io/v2/homebrew/core/nutcracker/blobs/sha256:c8c9e289383ed4b606246b5300a2b768642ed231a0526e6e9dab6e2f37e762bc",
          "sha256": "c8c9e289383ed4b606246b5300a2b768642ed231a0526e6e9dab6e2f37e762bc"
        },
        "arm64_big_sur": {
          "cellar": ":any",
          "url": "https://ghcr.io/v2/homebrew/core/nutcracker/blobs/sha256:5063c8fb5c2f1327bb0979be76cf05be72b879113b69667d9d6548d1db6da44b",
          "sha256": "5063c8fb5c2f1327bb0979be76cf05be72b879113b69667d9d6548d1db6da44b"
        },
        "ventura": {
          "cellar": ":any",
          "url": "https://ghcr.io/v2/homebrew/core/nutcracker/blobs/sha256:0fa603b54d16e0a34fc38095337cb3809ec3180249a18b114708aec49c344871",
          "sha256": "0fa603b54d16e0a34fc38095337cb3809ec3180249a18b114708aec49c344871"
        },
        "monterey": {
          "cellar": ":any",
          "url": "https://ghcr.io/v2/homebrew/core/nutcracker/blobs/sha256:0682fca355c4930be73a43fca315d8eb36a709413f60ebae19f58289eafe1916",
          "sha256": "0682fca355c4930be73a43fca315d8eb36a709413f60ebae19f58289eafe1916"
        },
        "big_sur": {
          "cellar": ":any",
          "url": "https://ghcr.io/v2/homebrew/core/nutcracker/blobs/sha256:a8a718227faa82141b08684c12654a04dee9ffc91df8157100fb5b51eb6fe8ba",
          "sha256": "a8a718227faa82141b08684c12654a04dee9ffc91df8157100fb5b51eb6fe8ba"
        },
        "catalina": {
          "cellar": ":any",
          "url": "https://ghcr.io/v2/homebrew/core/nutcracker/blobs/sha256:95055ec8487419f854e34be6212369081eaa574ebaa36dabb01b2047f2e31240",
          "sha256": "95055ec8487419f854e34be6212369081eaa574ebaa36dabb01b2047f2e31240"
        },
        "mojave": {
          "cellar": ":any",
          "url": "https://ghcr.io/v2/homebrew/core/nutcracker/blobs/sha256:eabbabd68f1627872a910374a15186b3c57c7ef7ebfa99a8d1a32bc15edf2f8a",
          "sha256": "eabbabd68f1627872a910374a15186b3c57c7ef7ebfa99a8d1a32bc15edf2f8a"
        },
        "x86_64_linux": {
          "cellar": ":any_skip_relocation",
          "url": "https://ghcr.io/v2/homebrew/core/nutcracker/blobs/sha256:6d6d4dcbb634abf13629537e4eaa0ee3a9fe87693492c3668c4effe4550a2cd8",
          "sha256": "6d6d4dcbb634abf13629537e4eaa0ee3a9fe87693492c3668c4effe4550a2cd8"
        }
      }
    }
  },
  "keg_only": false,
  "keg_only_reason": null,
  "options": [],
  "build_dependencies": [
    "autoconf",
    "automake",
    "libtool"
  ],
  "dependencies": [
    "libyaml"
  ],
  "test_dependencies": [],
  "recommended_dependencies": [],
  "optional_dependencies": [],
  "uses_from_macos": [],
  "uses_from_macos_bounds": [],
  "requirements": [],
  "conflicts_with": [],
  "conflicts_with_reasons": [],
  "link_overwrite": [],
  "caveats": null,
  "installed": [],
  "linked_keg": null,
  "pinned": false,
  "outdated": false,
  "deprecated": false,
  "deprecation_date": null,
  "deprecation_reason": null,
  "disabled": false,
  "disable_date": null,
  "disable_reason": null,
  "post_install_defined": false,
  "service": null,
  "tap_git_head": "4eeae4ea50839e967536ba646d5e0ed6fbcbad7f",
  "ruby_source_path": "Formula/nutcracker.rb",
  "ruby_source_checksum": {
    "sha256": "a4529286b74d749efa6b6a52191edd7e87614370361bdfdc5cbaddd3b402b265"
  },
  "date_added": "2014-05-05T20:36:47-07:00",
  "readme": "# twemproxy (nutcracker) [![Build Status](https://github.com/twitter/twemproxy/actions/workflows/main.yml/badge.svg?branch=master)](https://github.com/twitter/twemproxy/actions/workflows/main.yml?query=branch%3Amaster)\n\n**twemproxy** (pronounced \"two-em-proxy\"), aka **nutcracker** is a fast and lightweight proxy for [memcached](http://www.memcached.org/) and [redis](http://redis.io/) protocol. It was built primarily to reduce the number of connections to the caching servers on the backend. This, together with protocol pipelining and sharding enables you to horizontally scale your distributed caching architecture.\n\n## Build\n\nTo build twemproxy 0.5.0+ from [distribution tarball](https://github.com/twitter/twemproxy/releases):\n\n    $ ./configure\n    $ make\n    $ sudo make install\n\nTo build twemproxy 0.5.0+ from [distribution tarball](https://github.com/twitter/twemproxy/releases) in _debug mode_:\n\n    $ CFLAGS=\"-ggdb3 -O0\" ./configure --enable-debug=full\n    $ make\n    $ sudo make install\n\nTo build twemproxy from source with _debug logs enabled_ and _assertions enabled_:\n\n    $ git clone git@github.com:twitter/twemproxy.git\n    $ cd twemproxy\n    $ autoreconf -fvi\n    $ ./configure --enable-debug=full\n    $ make\n    $ src/nutcracker -h\n\nA quick checklist:\n\n+ Use newer version of gcc (older version of gcc has problems)\n+ Use CFLAGS=\"-O1\" ./configure && make\n+ Use CFLAGS=\"-O3 -fno-strict-aliasing\" ./configure && make\n+ `autoreconf -fvi && ./configure` needs `automake` and `libtool` to be installed\n\n`make check` will run unit tests.\n\n### Older Releases\n\nDistribution tarballs for older twemproxy releases (<= 0.4.1) can be found on [Google Drive](https://drive.google.com/open?id=0B6pVMMV5F5dfMUdJV25abllhUWM&authuser=0).\nThe build steps are the same (`./configure; make; sudo make install`).\n\n## Features\n\n+ Fast.\n+ Lightweight.\n+ Maintains persistent server connections.\n+ Keeps connection count on the backend caching servers low.\n+ Enables pipelining of requests and responses.\n+ Supports proxying to multiple servers.\n+ Supports multiple server pools simultaneously.\n+ Shard data automatically across multiple servers.\n+ Implements the complete [memcached ascii](notes/memcache.md) and [redis](notes/redis.md) protocol.\n+ Easy configuration of server pools through a YAML file.\n+ Supports multiple hashing modes including consistent hashing and distribution.\n+ Can be configured to disable nodes on failures.\n+ Observability via stats exposed on the stats monitoring port.\n+ Works with Linux, *BSD, OS X and SmartOS (Solaris)\n\n## Help\n\n    Usage: nutcracker [-?hVdDt] [-v verbosity level] [-o output file]\n                      [-c conf file] [-s stats port] [-a stats addr]\n                      [-i stats interval] [-p pid file] [-m mbuf size]\n\n    Options:\n      -h, --help             : this help\n      -V, --version          : show version and exit\n      -t, --test-conf        : test configuration for syntax errors and exit\n      -d, --daemonize        : run as a daemon\n      -D, --describe-stats   : print stats description and exit\n      -v, --verbose=N        : set logging level (default: 5, min: 0, max: 11)\n      -o, --output=S         : set logging file (default: stderr)\n      -c, --conf-file=S      : set configuration file (default: conf/nutcracker.yml)\n      -s, --stats-port=N     : set stats monitoring port (default: 22222)\n      -a, --stats-addr=S     : set stats monitoring ip (default: 0.0.0.0)\n      -i, --stats-interval=N : set stats aggregation interval in msec (default: 30000 msec)\n      -p, --pid-file=S       : set pid file (default: off)\n      -m, --mbuf-size=N      : set size of mbuf chunk in bytes (default: 16384 bytes)\n\n## Zero Copy\n\nIn twemproxy, all the memory for incoming requests and outgoing responses is allocated in mbuf. Mbuf enables zero-copy because the same buffer on which a request was received from the client is used for forwarding it to the server. Similarly the same mbuf on which a response was received from the server is used for forwarding it to the client.\n\nFurthermore, memory for mbufs is managed using a reuse pool. This means that once mbuf is allocated, it is not deallocated, but just put back into the reuse pool. By default each mbuf chunk is set to 16K bytes in size. There is a trade-off between the mbuf size and number of concurrent connections twemproxy can support. A large mbuf size reduces the number of read syscalls made by twemproxy when reading requests or responses. However, with a large mbuf size, every active connection would use up 16K bytes of buffer which might be an issue when twemproxy is handling large number of concurrent connections from clients. When twemproxy is meant to handle a large number of concurrent client connections, you should set chunk size to a small value like 512 bytes using the -m or --mbuf-size=N argument.\n\n## Configuration\n\nTwemproxy can be configured through a YAML file specified by the -c or --conf-file command-line argument on process start. The configuration file is used to specify the server pools and the servers within each pool that twemproxy manages. The configuration files parses and understands the following keys:\n\n+ **listen**: The listening address and port (name:port or ip:port) or an absolute path to sock file (e.g. /var/run/nutcracker.sock) for this server pool.\n+ **client_connections**: The maximum number of connections allowed from redis clients. Unlimited by default, though OS-imposed limitations will still apply.\n+ **hash**: The name of the hash function. Possible values are:\n  + one_at_a_time\n  + md5\n  + crc16\n  + crc32 (crc32 implementation compatible with [libmemcached](http://libmemcached.org/))\n  + crc32a (correct crc32 implementation as per the spec)\n  + fnv1_64\n  + fnv1a_64 (default)\n  + fnv1_32\n  + fnv1a_32\n  + hsieh\n  + murmur\n  + jenkins\n+ **hash_tag**: A two character string that specifies the part of the key used for hashing. Eg \"{}\" or \"$$\". [Hash tag](notes/recommendation.md#hash-tags) enable mapping different keys to the same server as long as the part of the key within the tag is the same.\n+ **distribution**: The key distribution mode for choosing backend servers based on the computed hash value. Possible values are:\n  + ketama (default, recommended. An implementation of https://en.wikipedia.org/wiki/Consistent_hashing)\n  + modula (use hash modulo number of servers to choose the backend)\n  + random (choose a random backend for each key of each request)\n+ **timeout**: The timeout value in msec that we wait for to establish a connection to the server or receive a response from a server. By default, we wait indefinitely.\n+ **backlog**: The TCP backlog argument. Defaults to 512.\n+ **tcpkeepalive**: A boolean value that controls if tcp keepalive is enabled for connections to servers. Defaults to false.\n+ **preconnect**: A boolean value that controls if twemproxy should preconnect to all the servers in this pool on process start. Defaults to false.\n+ **redis**: A boolean value that controls if a server pool speaks redis or memcached protocol. Defaults to false.\n+ **redis_auth**: Authenticate to the Redis server on connect.\n+ **redis_db**: The DB number to use on the pool servers. Defaults to 0. Note: Twemproxy will always present itself to clients as DB 0.\n+ **server_connections**: The maximum number of connections that can be opened to each server. By default, we open at most 1 server connection.\n+ **auto_eject_hosts**: A boolean value that controls if server should be ejected temporarily when it fails consecutively server_failure_limit times. See [liveness recommendations](notes/recommendation.md#liveness) for information. Defaults to false.\n+ **server_retry_timeout**: The timeout value in msec to wait for before retrying on a temporarily ejected server, when auto_eject_hosts is set to true. Defaults to 30000 msec.\n+ **server_failure_limit**: The number of consecutive failures on a server that would lead to it being temporarily ejected when auto_eject_hosts is set to true. Defaults to 2.\n+ **servers**: A list of server address, port and weight (name:port:weight or ip:port:weight) for this server pool.\n\n\nFor example, the configuration file in [conf/nutcracker.yml](conf/nutcracker.yml), also shown below, configures 5 server pools with names - _alpha_, _beta_, _gamma_, _delta_ and omega. Clients that intend to send requests to one of the 10 servers in pool delta connect to port 22124 on 127.0.0.1. Clients that intend to send request to one of 2 servers in pool omega connect to unix path /tmp/gamma. Requests sent to pool alpha and omega have no timeout and might require timeout functionality to be implemented on the client side. On the other hand, requests sent to pool beta, gamma and delta timeout after 400 msec, 400 msec and 100 msec respectively when no response is received from the server. Of the 5 server pools, only pools alpha, gamma and delta are configured to use server ejection and hence are resilient to server failures. All the 5 server pools use ketama consistent hashing for key distribution with the key hasher for pools alpha, beta, gamma and delta set to fnv1a_64 while that for pool omega set to hsieh. Also only pool beta uses [nodes names](notes/recommendation.md#node-names-for-consistent-hashing) for consistent hashing, while pool alpha, gamma, delta and omega use 'host:port:weight' for consistent hashing. Finally, only pool alpha and beta can speak the redis protocol, while pool gamma, delta and omega speak memcached protocol.\n\n    alpha:\n      listen: 127.0.0.1:22121\n      hash: fnv1a_64\n      distribution: ketama\n      auto_eject_hosts: true\n      redis: true\n      server_retry_timeout: 2000\n      server_failure_limit: 1\n      servers:\n       - 127.0.0.1:6379:1\n\n    beta:\n      listen: 127.0.0.1:22122\n      hash: fnv1a_64\n      hash_tag: \"{}\"\n      distribution: ketama\n      auto_eject_hosts: false\n      timeout: 400\n      redis: true\n      servers:\n       - 127.0.0.1:6380:1 server1\n       - 127.0.0.1:6381:1 server2\n       - 127.0.0.1:6382:1 server3\n       - 127.0.0.1:6383:1 server4\n\n    gamma:\n      listen: 127.0.0.1:22123\n      hash: fnv1a_64\n      distribution: ketama\n      timeout: 400\n      backlog: 1024\n      preconnect: true\n      auto_eject_hosts: true\n      server_retry_timeout: 2000\n      server_failure_limit: 3\n      servers:\n       - 127.0.0.1:11212:1\n       - 127.0.0.1:11213:1\n\n    delta:\n      listen: 127.0.0.1:22124\n      hash: fnv1a_64\n      distribution: ketama\n      timeout: 100\n      auto_eject_hosts: true\n      server_retry_timeout: 2000\n      server_failure_limit: 1\n      servers:\n       - 127.0.0.1:11214:1\n       - 127.0.0.1:11215:1\n       - 127.0.0.1:11216:1\n       - 127.0.0.1:11217:1\n       - 127.0.0.1:11218:1\n       - 127.0.0.1:11219:1\n       - 127.0.0.1:11220:1\n       - 127.0.0.1:11221:1\n       - 127.0.0.1:11222:1\n       - 127.0.0.1:11223:1\n\n    omega:\n      listen: /tmp/gamma 0666\n      hash: hsieh\n      distribution: ketama\n      auto_eject_hosts: false\n      servers:\n       - 127.0.0.1:11214:100000\n       - 127.0.0.1:11215:1\n\nFinally, to make writing a syntactically correct configuration file easier, twemproxy provides a command-line argument `-t` or `--test-conf` that can be used to test the YAML configuration file for any syntax error.\n\n## Observability\n\nObservability in twemproxy is through logs and stats.\n\nTwemproxy exposes stats at the granularity of server pool and servers per pool through the stats monitoring port by responding with the raw data over TCP. The stats are essentially JSON formatted key-value pairs, with the keys corresponding to counter names. By default stats are exposed on port 22222 and aggregated every 30 seconds. Both these values can be configured on program start using the `-c` or `--conf-file` and `-i` or `--stats-interval` command-line arguments respectively. You can print the description of all stats exported by  using the `-D` or `--describe-stats` command-line argument.\n\n    $ nutcracker --describe-stats\n\n    pool stats:\n      client_eof          \"# eof on client connections\"\n      client_err          \"# errors on client connections\"\n      client_connections  \"# active client connections\"\n      server_ejects       \"# times backend server was ejected\"\n      forward_error       \"# times we encountered a forwarding error\"\n      fragments           \"# fragments created from a multi-vector request\"\n\n    server stats:\n      server_eof          \"# eof on server connections\"\n      server_err          \"# errors on server connections\"\n      server_timedout     \"# timeouts on server connections\"\n      server_connections  \"# active server connections\"\n      requests            \"# requests\"\n      request_bytes       \"total request bytes\"\n      responses           \"# responses\"\n      response_bytes      \"total response bytes\"\n      in_queue            \"# requests in incoming queue\"\n      in_queue_bytes      \"current request bytes in incoming queue\"\n      out_queue           \"# requests in outgoing queue\"\n      out_queue_bytes     \"current request bytes in outgoing queue\"\n\nSee [`notes/debug.txt`](notes/debug.txt) for examples of how to read the stats from the stats port.\n\nLogging in twemproxy is only available when twemproxy is built with logging enabled. By default logs are written to stderr. Twemproxy can also be configured to write logs to a specific file through the `-o` or `--output` command-line argument. On a running twemproxy, we can turn log levels up and down by sending it SIGTTIN and SIGTTOU signals respectively and reopen log files by sending it SIGHUP signal.\n\n## Pipelining\n\nTwemproxy enables proxying multiple client connections onto one or few server connections. This architectural setup makes it ideal for pipelining requests and responses and hence saving on the round trip time.\n\nFor example, if twemproxy is proxying three client connections onto a single server and we get requests - `get key\\r\\n`, `set key 0 0 3\\r\\nval\\r\\n` and `delete key\\r\\n` on these three connections respectively, twemproxy would try to batch these requests and send them as a single message onto the server connection as `get key\\r\\nset key 0 0 3\\r\\nval\\r\\ndelete key\\r\\n`.\n\nPipelining is the reason why twemproxy ends up doing better in terms of throughput even though it introduces an extra hop between the client and server.\n\n## Deployment\n\nIf you are deploying twemproxy in production, you might consider reading through the [recommendation document](notes/recommendation.md) to understand the parameters you could tune in twemproxy to run it efficiently in the production environment.\n\n## Utils\n+ [collectd-plugin](https://github.com/bewie/collectd-twemproxy)\n+ [munin-plugin](https://github.com/eveiga/contrib/tree/nutcracker/plugins/nutcracker)\n+ [twemproxy-ganglia-module](https://github.com/ganglia/gmond_python_modules/tree/master/twemproxy)\n+ [nagios checks](https://github.com/wanelo/nagios-checks/blob/master/check_twemproxy)\n+ [circonus](https://github.com/wanelo-chef/nad-checks/blob/master/recipes/twemproxy.rb)\n+ [puppet module](https://github.com/wuakitv/puppet-twemproxy)\n+ [nutcracker-web](https://github.com/kontera-technologies/nutcracker-web)\n+ [redis-twemproxy agent](https://github.com/Stono/redis-twemproxy-agent)\n+ [sensu-metrics](https://github.com/sensu-plugins/sensu-plugins-twemproxy/blob/master/bin/metrics-twemproxy.rb)\n+ [redis-mgr](https://github.com/idning/redis-mgr)\n+ [smitty for twemproxy failover](https://github.com/areina/smitty)\n+ [Beholder, a Python agent for twemproxy failover](https://github.com/Serekh/beholder)\n+ [chef cookbook](https://supermarket.getchef.com/cookbooks/twemproxy)\n+ [twemsentinel](https://github.com/yak0/twemsentinel)\n\n## Companies using Twemproxy in Production\n+ [Twitter](https://twitter.com/)\n+ [Wikimedia](https://www.wikimedia.org/)\n+ [Pinterest](http://pinterest.com/)\n+ [Snapchat](http://www.snapchat.com/)\n+ [Flickr](https://www.flickr.com)\n+ [Yahoo!](https://www.yahoo.com)\n+ [Tumblr](https://www.tumblr.com/)\n+ [Vine](http://vine.co/)\n+ [Wayfair](http://www.wayfair.com/)\n+ [Kiip](http://www.kiip.me/)\n+ [Wuaki.tv](https://wuaki.tv/)\n+ [Wanelo](http://wanelo.com/)\n+ [Kontera](http://kontera.com/)\n+ [Bright](http://www.bright.com/)\n+ [56.com](http://www.56.com/)\n+ [Digg](http://digg.com/)\n+ [Gawkermedia](http://advertising.gawker.com/)\n+ [3scale.net](http://3scale.net)\n+ [Ooyala](http://www.ooyala.com)\n+ [Twitch](http://twitch.tv)\n+ [Socrata](http://www.socrata.com/)\n+ [Hootsuite](http://hootsuite.com/)\n+ [Trivago](http://www.trivago.com/)\n+ [Machinezone](http://www.machinezone.com)\n+ [Path](https://path.com)\n+ [AOL](http://engineering.aol.com/)\n+ [Soysuper](https://soysuper.com/)\n+ [Vinted](http://vinted.com/)\n+ [Poshmark](https://poshmark.com/)\n+ [FanDuel](https://www.fanduel.com/)\n+ [Bloomreach](http://bloomreach.com/)\n+ [Hootsuite](https://hootsuite.com)\n+ [Tradesy](https://www.tradesy.com/)\n+ [Uber](http://uber.com) ([details](http://highscalability.com/blog/2015/9/14/how-uber-scales-their-real-time-market-platform.html))\n+ [Greta](https://greta.io/)\n\n## Issues and Support\n\nHave a bug or a question? Please create an issue here on GitHub!\n\nhttps://github.com/twitter/twemproxy/issues\n\n## Committers\n\n* Manju Rajashekhar ([@manju](https://twitter.com/manju))\n* Lin Yang ([@idning](https://github.com/idning))\n* Tyson Andre ([@TysonAndre](https://github.com/TysonAndre))\n\nThank you to all of our [contributors](https://github.com/twitter/twemproxy/graphs/contributors)!\n\n## License\n\nCopyright 2012 Twitter, Inc.\n\nLicensed under the Apache License, Version 2.0: http://www.apache.org/licenses/LICENSE-2.0"
}
